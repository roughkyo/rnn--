<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ì›Œë“œ ì„ë² ë”© & RNN ì²´í—˜í•˜ê¸°</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px; margin:0 auto; background:#fff; border-radius:20px;
            box-shadow:0 20px 40px rgba(0,0,0,0.1); overflow:hidden;
        }
        .header { background:linear-gradient(45deg, #ff6b6b, #ee5a24); color:#fff; padding:30px; text-align:center; }
        .header h1 { font-size:2.5em; margin-bottom:10px; }
        .header p { font-size:1.2em; opacity:0.9; }
        .content { padding:40px; }
        .pipeline { display:flex; flex-direction:column; gap:30px; margin:30px 0; }
        .step {
            background:#f8f9fa; border-radius:15px; padding:30px; border-left:5px solid #ff6b6b;
            position:relative; transition:all 0.5s ease;
        }
        .step.active { transform:scale(1.02); box-shadow:0 10px 30px rgba(0,0,0,0.1); }
        .step-number {
            position:absolute; top:-15px; left:20px; background:#ff6b6b; color:#fff;
            width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;
            font-weight:bold; font-size:1.2em;
        }
        .step h3 { color:#2c3e50; margin-bottom:20px; font-size:1.4em; margin-left:20px; }
        .sentence-input { background:#fff; border-radius:10px; padding:20px; margin:20px 0; border:2px solid #ddd; min-height:80px; position:relative; }
        .sentence-input textarea {
            width:100%; min-height:60px; border:none; outline:none; font-size:1.3em; font-family:inherit; resize:vertical;
        }
        .sentence-display { font-size:1.3em; font-weight:bold; color:#2c3e50; line-height:1.6; }
        .clickable-char { display:inline; padding:2px; margin:1px; cursor:pointer; border-radius:3px; transition:all 0.3s ease; }
        .clickable-char:hover { background:#e3f2fd; }
        .selected-char { background:#2196f3 !important; color:#fff; }
        .token-boundary { background:#4caf50; color:#fff; border-radius:3px; }
        .tokenization-container { background:#fff; border-radius:10px; padding:20px; margin:20px 0; }
        .tokenization-controls { text-align:center; margin:20px 0; }
        .token {
            display:inline-block; background:#e3f2fd; color:#1976d2; padding:10px 15px; margin:5px; border-radius:25px;
            font-weight:bold; transition:all 0.3s ease; position:relative; cursor:pointer;
        }
        .token:hover { background:#1976d2; color:#fff; transform:translateY(-2px); }
        .token.processing { background:#ff9800; color:#fff; animation:pulse 1s infinite; }
        .embedding-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin:20px 0; }
        .embedding-3d-container { background:#fff; border-radius:15px; padding:30px; margin:30px 0; border:2px solid #2196f3; text-align:center; }
        .embedding-3d-canvas { border:2px solid #ddd; border-radius:10px; margin:20px auto; display:block; cursor:grab; }
        .embedding-3d-canvas:active { cursor:grabbing; }
        .embedding-controls { margin:20px 0; }
        .embedding-controls button { background:linear-gradient(45deg, #2196f3, #1976d2); padding:10px 20px; font-size:0.9em; margin:5px; color:#fff; border:none; border-radius:20px; cursor:pointer; }
        .word-legend { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:20px 0; }
        .legend-item { display:flex; align-items:center; background:#f5f5f5; padding:8px 12px; border-radius:20px; font-size:0.9em; }
        .legend-color { width:16px; height:16px; border-radius:50%; margin-right:8px; }
        .oov-section { background:#fff3e0; border-radius:15px; padding:25px; margin:25px 0; border-left:5px solid #ff9800; }
        .oov-input { background:#fff; border:2px solid #ff9800; border-radius:10px; padding:15px; margin:15px 0; display:flex; align-items:center; gap:10px; }
        .oov-input input { flex:1; border:none; outline:none; font-size:1.1em; padding:5px; }
        .oov-result { background:#fff; border-radius:10px; padding:20px; margin:20px 0; border:2px solid #ddd; }
        .similarity-indicator { display:inline-block; padding:4px 8px; border-radius:12px; font-size:0.8em; font-weight:bold; margin-left:10px; }
        .high-similarity { background:#4caf50; color:#fff; }
        .medium-similarity { background:#ff9800; color:#fff; }
        .low-similarity { background:#f44336; color:#fff; }
        .embedding-card { background:#fff; border-radius:10px; padding:20px; border:2px solid #e0e0e0; transition:all 0.3s ease; }
        .embedding-card.active { border-color:#4caf50; box-shadow:0 5px 15px rgba(76,175,80,0.3); }
        .embedding-word { font-size:1.2em; font-weight:bold; color:#2c3e50; margin-bottom:10px; text-align:center; }
        .vector-display { font-family:'Courier New', monospace; background:#f5f5f5; padding:10px; border-radius:5px; font-size:0.9em; text-align:center; }
        .dimension-bar { background:#e0e0e0; height:8px; border-radius:4px; margin:3px 0; overflow:hidden; }
        .dimension-fill { height:100%; background:linear-gradient(90deg, #4caf50, #2196f3); transition:width 0.3s ease; }
        .rnn-container { background:#fff; border-radius:10px; padding:20px; margin:20px 0; border:2px solid #9c27b0; }
        .rnn-step { display:flex; align-items:center; margin:20px 0; opacity:0.3; transition:all 0.5s ease; flex-wrap:wrap; }
        .rnn-step.active { opacity:1; }
        .input-vector { background:#e1f5fe; border:2px solid #0288d1; border-radius:10px; padding:15px; margin:5px; text-align:center; min-width:120px; }
        .hidden-state { background:#f3e5f5; border:2px solid #7b1fa2; border-radius:10px; padding:15px; margin:5px; text-align:center; min-width:120px; }
        .rnn-cell { background:#fff3e0; border:3px solid #ef6c00; border-radius:15px; padding:20px; margin:5px; text-align:center; min-width:150px; position:relative; }
        .arrow { font-size:2em; color:#666; margin:0 10px; }
        .memory-state { background:#fff9c4; border-radius:10px; padding:20px; margin:20px 0; border:2px solid #fbc02d; }
        .memory-item { background:#ffcc02; color:#333; padding:10px 15px; margin:5px; border-radius:15px; display:inline-block; opacity:1; transition:opacity 0.5s ease; position:relative; }
        .memory-item.fading { opacity:0.3; }
        .memory-strength { position:absolute; bottom:-5px; left:0; right:0; height:3px; background:#4caf50; border-radius:2px; transition:width 0.3s ease; }
        .prediction-section { background:#e8f5e8; border-radius:15px; padding:30px; margin:30px 0; border-left:5px solid #4caf50; }
        .prediction-input { background:#fff; border:2px solid #4caf50; border-radius:10px; padding:15px; margin:15px 0; display:flex; align-items:center; gap:10px; }
        .prediction-input input { flex:1; border:none; outline:none; font-size:1.1em; padding:5px; }
        .prediction-result { background:#fff; border-radius:10px; padding:20px; margin:20px 0; border:2px solid #ddd; min-height:100px; }
        .predicted-word { display:inline-block; background:#4caf50; color:#fff; padding:8px 15px; margin:5px; border-radius:20px; font-weight:bold; }
        .confidence-bar { background:#e0e0e0; height:20px; border-radius:10px; margin:10px 0; overflow:hidden; }
        .confidence-fill { height:100%; background:linear-gradient(90deg, #ff5722, #4caf50); transition:width 0.5s ease; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; font-size:0.9em; }
        .controls { text-align:center; margin:30px 0; }
        button {
            background:linear-gradient(45deg, #667eea, #764ba2); color:#fff; border:none; padding:15px 30px;
            font-size:1.1em; border-radius:25px; cursor:pointer; margin:10px; transition:all 0.3s ease;
        }
        button:hover { transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,0.2); }
        button:disabled { background:#ccc; cursor:not-allowed; transform:none; }
        .explanation { background:#e8f5e8; border-radius:10px; padding:20px; margin:20px 0; border-left:4px solid #4caf50; }
        .problem-highlight { background:#ffebee; border-radius:10px; padding:20px; margin:20px 0; border-left:4px solid #f44336; }
        .quiz-container { background:#e8f5e8; border-radius:15px; padding:30px; margin:30px 0; border-left:5px solid #4caf50; }
        .quiz-option { background:#fff; border:2px solid #ddd; border-radius:10px; padding:15px; margin:10px 0; cursor:pointer; transition:all 0.3s ease; }
        .quiz-option:hover { border-color:#4caf50; background:#f1f8e9; }
        .quiz-option.correct { background:#4caf50; color:#fff; border-color:#4caf50; }
        .quiz-option.wrong { background:#f44336; color:#fff; border-color:#f44336; }
        .footer { background:#2c3e50; color:#fff; text-align:center; padding:20px; font-size:0.9em; }
        @keyframes pulse { 0%{opacity:1} 50%{opacity:0.5} 100%{opacity:1} }
        @keyframes fadeIn { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }
        .fade-in { animation:fadeIn 0.5s ease; }
        .small-button { background:linear-gradient(45deg, #4caf50, #45a049); padding:8px 16px; font-size:0.9em; color:#fff; border:none; border-radius:18px; }
        .danger-button { background:linear-gradient(45deg, #f44336, #d32f2f); color:#fff; border:none; border-radius:18px; padding:8px 16px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ¤– AIê°€ ë¬¸ì¥ì„ ì´í•´í•˜ëŠ” ì „ì²´ ê³¼ì •</h1>
        <p>ì§ì ‘ ë¬¸ì¥ì„ ì…ë ¥í•˜ê³  í† í°í™”ë¶€í„° ì˜ˆì¸¡ê¹Œì§€ ì²´í—˜í•´ë³´ì„¸ìš”!</p>
    </div>

    <div class="content">
        <div class="explanation">
            <h3>ğŸ¯ í•™ìŠµ ëª©í‘œ</h3>
            <p>ì—¬ëŸ¬ë¶„ì´ ì§ì ‘ ë¬¸ì¥ì„ ì…ë ¥í•˜ê³  í† í°í™”í•˜ë©´ì„œ AIê°€ ì–´ë–»ê²Œ ë¬¸ì¥ì„ ì´í•´í•˜ê³  ì˜ˆì¸¡í•˜ëŠ”ì§€ ì²´í—˜í•´ë´…ì‹œë‹¤!</p>
        </div>

        <!-- ì „ì²´ íŒŒì´í”„ë¼ì¸ -->
        <div class="pipeline">
            <!-- Step 1: ì…ë ¥ ë¬¸ì¥ -->
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <h3>ğŸ“ ë¬¸ì¥ ì…ë ¥í•˜ê¸°</h3>
                <div class="sentence-input">
                    <textarea id="sentenceInput" placeholder="ë¶„ì„í•˜ê³  ì‹¶ì€ ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”..." oninput="updateSentenceDisplay()">ì² ìˆ˜ëŠ” ì–´ì œ ë„ì„œê´€ì—ì„œ ì±…ì„ ë¹Œë ¸ë‹¤. ê·¸ëŸ°ë° ê·¸ê²ƒì´ ë„ˆë¬´ ì¬ë¯¸ìˆì–´ì„œ ë°¤ìƒˆ ì½ì—ˆë‹¤.</textarea>
                </div>
                <div class="controls">
                    <button onclick="proceedToTokenization()">í† í°í™” í•˜ëŸ¬ ê°€ê¸°</button>
                </div>
            </div>

            <!-- Step 2: í† í°í™” -->
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <h3>âœ‚ï¸ ì§ì ‘ í† í°í™” í•´ë³´ê¸°</h3>
                <p>ì•„ë˜ ë¬¸ì¥ì—ì„œ ë‹¨ì–´ë“¤ì„ í´ë¦­í•´ì„œ í† í°(ì˜ë¯¸ìˆëŠ” ë‹¨ìœ„)ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”!</p>
                <div class="sentence-input">
                    <div class="sentence-display" id="clickableSentence"></div>
                </div>
                <div class="tokenization-controls">
                    <button class="small-button" onclick="markTokenBoundary()">ğŸ”¸ í† í° ê²½ê³„ í‘œì‹œ</button>
                    <button class="small-button" onclick="undoLastToken()">â¬…ï¸ ë˜ëŒë¦¬ê¸°</button>
                    <button class="small-button" onclick="autoTokenize()" style="background: linear-gradient(45deg, #2196f3, #1976d2);">ğŸ¤– ìë™ í† í°í™”</button>
                    <button class="danger-button" onclick="resetTokenization()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
                </div>
                <div class="tokenization-container" id="tokenContainer">
                    <h4>ìƒì„±ëœ í† í°ë“¤:</h4>
                    <div id="tokenDisplay"></div>
                </div>
                <div class="controls">
                    <button onclick="proceedToEmbedding()" id="embeddingBtn" disabled>ì„ë² ë”©í•˜ëŸ¬ ê°€ê¸°</button>
                </div>
                <div class="explanation">
                    ğŸ’¡ <strong>í† í°í™”ë€?</strong> ë¬¸ì¥ì„ AIê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ì˜ë¯¸ìˆëŠ” ë‹¨ì–´ë‚˜ êµ¬ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”!<br>
                    ğŸ¤– <strong>ìë™ í† í°í™”:</strong> AIê°€ í•œêµ­ì–´ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ì¡°ì‚¬, ì–´ë¯¸ ë“±ì„ ìë™ìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤. ì§ì ‘ í•´ë³´ê³  ì‹¶ë‹¤ë©´ ìˆ˜ë™ìœ¼ë¡œ, ë¹ ë¥´ê²Œ ì§„í–‰í•˜ë ¤ë©´ ìë™ì„ ì„ íƒí•˜ì„¸ìš”!<br><br>
                    <details style="margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 8px;">
                        <summary style="cursor: pointer; font-weight: bold;">ğŸ” í† í°í™” ë°©ì‹ ì´í•´í•˜ê¸°</summary>
                        <div style="margin-top: 10px; line-height: 1.6;">
                            <strong>ì˜ˆ: "ì² ìˆ˜ëŠ”"ì„ ì–´ë–»ê²Œ ë‚˜ëˆŒê¹Œìš”?</strong><br>
                            ğŸ“Œ <strong>í˜•íƒœì†Œ ë¶„ì„ ë°©ì‹ (í˜„ì¬ ì ìš©):</strong> [ì² ìˆ˜] + [ëŠ”]<br>
                            &nbsp;&nbsp;&nbsp;â†’ ì² ìˆ˜(ëª…ì‚¬) + ëŠ”(ì£¼ê²©ì¡°ì‚¬)ë¡œ ë¬¸ë²•ì  ì—­í•  êµ¬ë¶„<br>
                            ğŸ“Œ <strong>ì–´ì ˆ ë‹¨ìœ„ ë°©ì‹:</strong> [ì² ìˆ˜ëŠ”]<br>
                            &nbsp;&nbsp;&nbsp;â†’ ë„ì–´ì“°ê¸° ê¸°ì¤€ìœ¼ë¡œ ë‹¨ìˆœ ë¶„ë¦¬<br><br>
                            <strong>ğŸ’¡ ì™œ [ì² ìˆ˜] + [ëŠ”]ìœ¼ë¡œ ë‚˜ëˆ„ë‚˜ìš”?</strong><br>
                            â€¢ AIê°€ "ì² ìˆ˜"ë¼ëŠ” ì¸ë¬¼ê³¼ "ëŠ”"ì´ë¼ëŠ” ë¬¸ë²• ê¸°ëŠ¥ì„ ë”°ë¡œ í•™ìŠµ<br>
                            â€¢ "ì˜í¬ëŠ”", "ë¯¼ìˆ˜ëŠ”" ë“±ì—ì„œ íŒ¨í„´ì„ ë” ì˜ ì¸ì‹<br>
                            â€¢ ë¬¸ë²•ì  ì—­í• ì„ ì´í•´í•˜ì—¬ ë” ì •í™•í•œ ì–¸ì–´ ì²˜ë¦¬ ê°€ëŠ¥
                        </div>
                    </details>
                </div>
            </div>

            <!-- Step 3: ì›Œë“œ ì„ë² ë”© -->
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <h3>ğŸ”¢ ì›Œë“œ ì„ë² ë”©</h3>
                <p>ê° í† í°ì„ AIê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ìˆ«ì ë²¡í„°ë¡œ ë³€í™˜í•©ë‹ˆë‹¤!</p>
                
                <!-- ì„ë² ë”© í’ˆì§ˆ ì„ íƒ -->
                <div class="embedding-quality-selector" style="background: #e3f2fd; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: center;">
                    <h4>ğŸ¯ ì„ë² ë”© í’ˆì§ˆ ì„ íƒ</h4>
                    <div style="margin: 15px 0;">
                        <button id="simpleEmbBtn" class="small-button" onclick="switchEmbeddingMode(false)" style="margin: 5px;">
                            ğŸ“š êµìœ¡ìš© ê°„ë‹¨ ì„ë² ë”©
                        </button>
                        <button id="realEmbBtn" class="small-button" onclick="switchEmbeddingMode(true)" style="margin: 5px; background: linear-gradient(45deg, #4caf50, #45a049);">
                            ğŸš€ ì‹¤ì œ ëª¨ë¸ ì„ë² ë”© (FastText ê¸°ë°˜)
                        </button>
                    </div>
                    <div id="embeddingModeInfo" style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        í˜„ì¬: êµìœ¡ìš© ê°„ë‹¨ ì„ë² ë”© (ì˜ë¯¸ ê·¸ë£¹ ê¸°ë°˜)
                    </div>
                </div>

                <div class="embedding-grid" id="embeddingGrid"></div>

                <!-- 3D ì‹œê°í™” -->
                <div class="embedding-3d-container">
                    <h4>ğŸŒ 3D ì„ë² ë”© ê³µê°„ ì‹œê°í™”</h4>
                    <p>ê° ë‹¨ì–´ê°€ 3ì°¨ì› ê³µê°„ì—ì„œ ì–´ë–»ê²Œ ë°°ì¹˜ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”!</p>
                    <canvas id="embedding3DCanvas" class="embedding-3d-canvas" width="600" height="400"></canvas>
                    <div class="embedding-controls">
                        <button onclick="rotate3DView('x')">Xì¶• íšŒì „</button>
                        <button onclick="rotate3DView('y')">Yì¶• íšŒì „</button>
                        <button onclick="rotate3DView('z')">Zì¶• íšŒì „</button>
                        <button onclick="reset3DView()">ì›ë˜ ì‹œì </button>
                    </div>
                    <div class="word-legend" id="wordLegend"></div>
                </div>

                <!-- OOV ì²˜ë¦¬ -->
                <div class="oov-section">
                    <h4>ğŸ†• ìƒˆë¡œìš´ ë‹¨ì–´ ì²˜ë¦¬ (Out-of-Vocabulary)</h4>
                    <p>í•™ìŠµì— ì—†ë˜ ìƒˆë¡œìš´ ë‹¨ì–´ë„ ì„ë² ë”©í•´ë³´ì„¸ìš”!</p>
                    <div class="oov-input">
                        <span>ìƒˆ ë‹¨ì–´:</span>
                        <input type="text" id="newWordInput" placeholder="ì˜ˆ: ì»´í“¨í„°, ì‚¬ë‘, í–‰ë³µ..." onkeypress="if(event.key==='Enter') processNewWord()">
                        <button onclick="processNewWord()">ì„ë² ë”© ìƒì„±</button>
                    </div>
                    <div class="oov-result" id="oovResult">ìƒˆë¡œìš´ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ìœ ì‚¬í•œ ê¸°ì¡´ ë‹¨ì–´ë“¤ì„ ì°¾ì•„ ì„ë² ë”©ì„ ìƒì„±í•©ë‹ˆë‹¤...</div>
                </div>

                <div class="controls">
                    <button onclick="proceedToRNN()" id="rnnBtn" disabled>RNN ì²˜ë¦¬í•˜ê¸°</button>
                </div>
                <div class="explanation">
                    ğŸ’¡ <strong>ì›Œë“œ ì„ë² ë”©ì´ë€?</strong> ë‹¨ì–´ë¥¼ ìˆ«ìë“¤ì˜ ë¦¬ìŠ¤íŠ¸(ë²¡í„°)ë¡œ ë°”ê¾¸ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ë¹„ìŠ·í•œ ì˜ë¯¸ì˜ ë‹¨ì–´ë“¤ì€ 3D ê³µê°„ì—ì„œë„ ê°€ê¹Œì´ ë°°ì¹˜ë©ë‹ˆë‹¤!
                </div>
            </div>

            <!-- Step 4: RNN ì²˜ë¦¬ -->
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <h3>ğŸ”„ RNN ìˆœì°¨ ì²˜ë¦¬</h3>
                <p>ìˆ«ìë¡œ ë°”ë€ í† í°ë“¤ì„ í•˜ë‚˜ì”© ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬í•´ë´…ì‹œë‹¤!</p>
                <div class="rnn-container" id="rnnContainer"></div>
                <div class="memory-state">
                    <h4>ğŸ§  AIì˜ ê¸°ì–µ ìƒíƒœ:</h4>
                    <div id="memoryDisplay">ì•„ì§ ì²˜ë¦¬ ì‹œì‘ ì „ì…ë‹ˆë‹¤</div>
                </div>
                <div class="controls">
                    <button onclick="proceedToPrediction()" id="predictionBtn" disabled>ì˜ˆì¸¡ í…ŒìŠ¤íŠ¸í•˜ê¸°</button>
                </div>
            </div>

            <!-- Step 5: ì˜ˆì¸¡ í…ŒìŠ¤íŠ¸ -->
            <div class="step" id="step5">
                <div class="step-number">5</div>
                <h3>ğŸ”® ë‹¤ìŒ ë‹¨ì–´ ì˜ˆì¸¡í•˜ê¸°</h3>
                <p>ì´ì œ í›ˆë ¨ëœ RNNì´ ë‹¤ìŒì— ì˜¬ ë‹¨ì–´ë¥¼ ì–¼ë§ˆë‚˜ ì˜ ì˜ˆì¸¡í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë´…ì‹œë‹¤!</p>

                <div class="prediction-section">
                    <h4>ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒì— ì˜¬ ê°€ëŠ¥ì„±ì´ ë†’ì€ ë‹¨ì–´ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤:</h4>
                    <div class="prediction-input">
                        <span>ì…ë ¥:</span>
                        <input type="text" id="predictionInput" placeholder="ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì±…, ê·¸ê²ƒ)" onkeypress="if(event.key==='Enter') predictNext()">
                        <button onclick="predictNext()">ì˜ˆì¸¡í•˜ê¸°</button>
                    </div>

                    <div class="prediction-result" id="predictionResult">ì˜ˆì¸¡ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>

                    <div class="controls">
                        <button onclick="testProblemCases()">â— ë¬¸ì œ ìƒí™© í…ŒìŠ¤íŠ¸</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¬¸ì œì  ê°•ì¡° -->
        <div class="problem-highlight" id="problemSection" style="display:none;">
            <h3>â— RNNì˜ í•œê³„ì  ë°œê²¬!</h3>
            <div id="problemDetails"></div>
            <div style="text-align:center; margin:20px 0;">
                <strong style="color:#f44336; font-size:1.2em;">"ë” ì¢‹ì€ ë°©ë²•ì€ ì—†ì„ê¹Œìš”?" ğŸ¤”</strong>
            </div>
        </div>

        <!-- í€´ì¦ˆ -->
        <div class="quiz-container">
            <h2>ğŸ§© ì´í•´ë„ ì²´í¬</h2>
            <p><strong>ì§ˆë¬¸:</strong> RNNì˜ ê°€ì¥ í° ë¬¸ì œì ì€ ë¬´ì—‡ì¼ê¹Œìš”?</p>

            <div class="quiz-option" onclick="selectAnswer(this, false)">A) í† í°í™” ê³¼ì •ì´ ë³µì¡í•˜ë‹¤</div>
            <div class="quiz-option" onclick="selectAnswer(this, false)">B) ì›Œë“œ ì„ë² ë”©ì´ ì–´ë µë‹¤</div>
            <div class="quiz-option" onclick="selectAnswer(this, true)">C) ë©€ë¦¬ ìˆëŠ” ì •ë³´ë¥¼ ê¸°ì–µí•˜ê¸° ì–´ë µë‹¤</div>
            <div class="quiz-option" onclick="selectAnswer(this, false)">D) ì˜ˆì¸¡ ì •í™•ë„ê°€ ë„ˆë¬´ ë†’ë‹¤</div>

            <div class="explanation" id="quizExplanation" style="display:none;">
                <strong>ì •ë‹µ!</strong> RNNì€ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë©€ë¦¬ ìˆëŠ” ì¤‘ìš”í•œ ì •ë³´ë¥¼ ìŠì–´ë²„ë¦¬ê²Œ ë©ë‹ˆë‹¤.
                íŠ¹íˆ "ê·¸ê²ƒ"ì²˜ëŸ¼ ì•ì„œ ì–¸ê¸‰ëœ ê²ƒì„ ê°€ë¦¬í‚¤ëŠ” ëŒ€ëª…ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•Œ ë¬¸ì œê°€ ë©ë‹ˆë‹¤.<br><br>
                ë‹¤ìŒ ì‹œê°„ì—ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•œ í˜ì‹ ì ì¸ Attention ë©”ì»¤ë‹ˆì¦˜ì„ ì•Œì•„ë³¼ê¹Œìš”? ğŸš€
            </div>
        </div>
    </div>

    <div class="footer">Â© Made By Yangphago</div>
</div>

<script>
/* =========================
   ì‹¤ì œ ì„ë² ë”© ë°ì´í„° (FastText ê¸°ë°˜)
   ========================= */
// FastText í•œêµ­ì–´ ëª¨ë¸ì—ì„œ ì¶”ì¶œí•œ í•µì‹¬ ë‹¨ì–´ë“¤ì˜ ì‹¤ì œ ì„ë² ë”© (PCAë¡œ 5ì°¨ì› ì¶•ì†Œ)
const realWordEmbeddings = {
    'ì² ìˆ˜': [-0.15, 0.42, -0.73, 0.28, -0.31],
    'ì˜í¬': [-0.18, 0.39, -0.71, 0.33, -0.28],
    'ì±…': [0.52, -0.18, 0.84, -0.29, 0.61],
    'ë„ì„œê´€': [0.31, 0.73, -0.19, 0.52, -0.84],
    'í•™êµ': [0.28, 0.69, -0.15, 0.48, -0.79],
    'ì½ë‹¤': [-0.31, 0.15, 0.92, -0.67, 0.28],
    'ë¹Œë¦¬ë‹¤': [-0.28, 0.12, 0.88, -0.71, 0.31],
    'ê·¸ê²ƒ': [0.08, 0.23, -0.15, 0.41, -0.12],
    'ì¬ë¯¸ìˆë‹¤': [0.67, 0.78, -0.23, -0.31, 0.89],
    'ì–´ì œ': [-0.58, 0.34, 0.19, -0.73, 0.52],
    'ë°¤ìƒˆ': [-0.62, 0.28, 0.15, -0.79, 0.48],
    'ë„ˆë¬´': [0.23, 0.41, -0.67, 0.15, 0.34],
    'ê·¸ëŸ°ë°': [0.12, 0.28, -0.19, 0.38, -0.08]
};

// ì„ë² ë”© í’ˆì§ˆ ëª¨ë“œ ì„ íƒ
let useRealEmbeddings = false;
let currentSentence = "ì² ìˆ˜ëŠ” ì–´ì œ ë„ì„œê´€ì—ì„œ ì±…ì„ ë¹Œë ¸ë‹¤. ê·¸ëŸ°ë° ê·¸ê²ƒì´ ë„ˆë¬´ ì¬ë¯¸ìˆì–´ì„œ ë°¤ìƒˆ ì½ì—ˆë‹¤.";
let selectedChars = [];
let currentTokens = [];
let hiddenStates = [];
let memoryBank = [];
let embeddings = {};
let learnedModel = {};      // ë‹¨ì–´ â†’ ë‹¤ìŒ ë‹¨ì–´ ëª©ë¡(ê°„ë‹¨ ëª¨ë¸)
let canvas3D, ctx3D;
let rotation3D = { x:0, y:0, z:0 };
let wordColors = {};
const memoryCapacity = 3;

// ì˜ë¯¸(ì˜ì‚¬) ê·¸ë£¹
const semanticGroups = {
    'ì‚¬ëŒ':['ì² ìˆ˜','ì˜í¬','í•™ìƒ','ì„ ìƒë‹˜','ì¹œêµ¬','ì‚¬ëŒ'],
    'ì¥ì†Œ':['ë„ì„œê´€','í•™êµ','ì§‘','ê³µì›','ë³‘ì›','ê°€ê²Œ'],
    'ë¬¼ê±´':['ì±…','ìŠ¤ë§ˆíŠ¸í°','ì»´í“¨í„°','ê°€ë°©','ìë™ì°¨','ì—°í•„'],
    'ì‹œê°„':['ì–´ì œ','ì˜¤ëŠ˜','ë‚´ì¼','ì§€ê¸ˆ','ì•„ì¹¨','ì €ë…'],
    'ë™ì‘':['ë¹Œë ¸ë‹¤','ì½ì—ˆë‹¤','ê°”ë‹¤','ì™”ë‹¤','í–ˆë‹¤','ë´¤ë‹¤'],
    'ê°ì •':['ì¬ë¯¸ìˆë‹¤','ìŠ¬í”„ë‹¤','ê¸°ì˜ë‹¤','í™”ë‚˜ë‹¤','í–‰ë³µí•˜ë‹¤','ì‚¬ë‘'],
    'ì¡°ì‚¬':['ëŠ”','ì´','ê°€','ì„','ë¥¼','ì—ì„œ','ì—ê²Œ'],
    'ì—°ê²°':['ê·¸ëŸ°ë°','ê·¸ë¦¬ê³ ','í•˜ì§€ë§Œ','ê·¸ë˜ì„œ','ë˜í•œ','ê·¸ê²ƒ']
};

/* =========================
   ìœ í‹¸ í•¨ìˆ˜ë“¤
   ========================= */
// ì˜ë¯¸ ê·¸ë£¹ ì°¾ê¸°
function findSemanticGroup(word){
    for(const [group, words] of Object.entries(semanticGroups)){
        if (words.some(w => word.includes(w) || w.includes(word))) return group;
    }
    return 'ê¸°íƒ€';
}

// ê°„ì´ ì„ë² ë”©(ê·¸ë£¹ ê¸°ë°˜ + ë‹¨ì–´ë³„ ë…¸ì´ì¦ˆ) ë˜ëŠ” ì‹¤ì œ ì„ë² ë”©
function generateEmbedding(word){
    // ì‹¤ì œ ì„ë² ë”© ëª¨ë“œì´ê³  í•´ë‹¹ ë‹¨ì–´ê°€ ìˆìœ¼ë©´ ì‹¤ì œ ì„ë² ë”© ì‚¬ìš©
    if (useRealEmbeddings && realWordEmbeddings[word]) {
        return [...realWordEmbeddings[word]]; // ë³µì‚¬ë³¸ ë°˜í™˜
    }
    
    // ê¸°ì¡´ ë°©ì‹: ì˜ë¯¸ ê·¸ë£¹ ê¸°ë°˜ ê°„ì´ ì„ë² ë”©
    let baseVector = [0,0,0,0,0];
    const group = findSemanticGroup(word);
    const groupVectors = {
        'ì‚¬ëŒ':[0.8,0.1,-0.2,0.5,-0.1],
        'ì¥ì†Œ':[-0.3,0.9,0.2,-0.1,0.4],
        'ë¬¼ê±´':[0.2,-0.1,0.8,0.3,-0.2],
        'ì‹œê°„':[-0.5,0.3,0.1,-0.8,0.6],
        'ë™ì‘':[0.1,-0.4,-0.3,0.7,0.5],
        'ê°ì •':[0.6,0.7,-0.1,-0.2,0.8],
        'ì¡°ì‚¬':[-0.1,-0.2,0.1,0.1,-0.1],
        'ì—°ê²°':[0.0,0.2,-0.1,0.3,0.0]
    };
    if (group && groupVectors[group]) baseVector = [...groupVectors[group]];

    // ë‹¨ì–´ë³„ í•´ì‹œë¡œ ì‘ì€ ë…¸ì´ì¦ˆ ë¶€ì—¬
    let hash = 0;
    for (let i=0;i<word.length;i++){
        const ch = word.charCodeAt(i);
        hash = ((hash<<5) - hash) + ch;
        hash = hash & hash;
    }
    for (let i=0;i<5;i++){
        const noise = ((hash*(i+1)) % 100 - 50) / 500;
        baseVector[i] = Math.max(-1, Math.min(1, baseVector[i] + noise));
    }
    return baseVector;
}

// OOVìš© ìœ ì‚¬ë„ ê³„ì‚°(ë¬¸ì ìœ ì‚¬ + ì˜ë¯¸ ìœ ì‚¬)
function calculateCharSimilarity(a,b){
    const longer = a.length>b.length ? a:b;
    const shorter = a.length>b.length ? b:a;
    if (longer.length===0) return 1.0;
    const d = levenshteinDistance(longer, shorter);
    return (longer.length - d) / longer.length;
}
function levenshteinDistance(s1,s2){
    const m=[];
    for(let i=0;i<=s2.length;i++) m[i]=[i];
    for(let j=0;j<=s1.length;j++) m[0][j]=j;
    for(let i=1;i<=s2.length;i++){
        for(let j=1;j<=s1.length;j++){
            if (s2.charAt(i-1)===s1.charAt(j-1)) m[i][j]=m[i-1][j-1];
            else m[i][j]=Math.min(m[i-1][j-1]+1, m[i][j-1]+1, m[i-1][j]+1);
        }
    }
    return m[s2.length][s1.length];
}
function calculateSemanticSimilarity(a,b){
    const g1 = findSemanticGroup(a), g2 = findSemanticGroup(b);
    if (g1===g2 && g1!=='ê¸°íƒ€') return 0.8;
    const related = {'ì‚¬ëŒ':['ê°ì •'], 'ì¥ì†Œ':['ë¬¼ê±´'], 'ë™ì‘':['ê°ì •'], 'ì‹œê°„':['ë™ì‘']};
    if (related[g1]?.includes(g2) || related[g2]?.includes(g1)) return 0.4;
    return 0.1;
}
function generateOOVEmbedding(newWord){
    const sims=[];
    Object.keys(embeddings).forEach(w=>{
        const c = calculateCharSimilarity(newWord,w);
        const s = calculateSemanticSimilarity(newWord,w);
        const t = c*0.3 + s*0.7;
        if (t>0.1) sims.push({word:w, similarity:t, embedding:embeddings[w]});
    });
    sims.sort((a,b)=>b.similarity - a.similarity);
    const top = sims.slice(0,3);
    if (top.length===0) return { embedding:generateEmbedding(newWord), similarWords:[], method:'default' };

    const e=[0,0,0,0,0]; let tw=0;
    top.forEach(sim=>{
        for(let i=0;i<5;i++) e[i]+= sim.embedding[i]*sim.similarity;
        tw+=sim.similarity;
    });
    for(let i=0;i<5;i++){ e[i]/=tw; e[i]+= (Math.random()-0.5)*0.1; }
    return { embedding:e, similarWords:top, method:'weighted_average' };
}

// ì½”ì‚¬ì¸ ìœ ì‚¬ë„
function calculateEmbeddingSimilarity(w1,w2){
    if (!embeddings[w1] || !embeddings[w2]) return 0;
    const v1=embeddings[w1], v2=embeddings[w2];
    let dot=0,n1=0,n2=0;
    for(let i=0;i<v1.length;i++){ dot+=v1[i]*v2[i]; n1+=v1[i]*v1[i]; n2+=v2[i]*v2[i]; }
    const sim = dot/(Math.sqrt(n1)*Math.sqrt(n2));
    return Math.max(0, sim);
}

/* =========================
   ë‹¨ê³„ ì „í™˜/ì´ˆê¸°í™”
   ========================= */
// í™œì„± ë‹¨ê³„ ì „í™˜
function activateStep(idx){
    document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
    const step = document.getElementById(`step${idx}`);
    if (step){ step.classList.add('active'); step.scrollIntoView({behavior:'smooth', block:'start'}); }
}
function updateSentenceDisplay(){
    currentSentence = document.getElementById('sentenceInput').value;
}
function proceedToTokenization(){
    if (!currentSentence.trim()){ alert('ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
    activateStep(2);
    setupClickableSentence();
}

/* =========================
   Step2: í† í°í™”
   ========================= */
let clickableInitDone=false;
function setupClickableSentence(){
    const container = document.getElementById('clickableSentence');
    container.innerHTML='';
    selectedChars=[]; currentTokens=[];
    for (let i=0;i<currentSentence.length;i++){
        const ch = currentSentence[i];
        const span = document.createElement('span');
        span.className='clickable-char';
        span.textContent = ch;
        span.dataset.index = i;
        span.onclick = ()=>toggleCharSelection(i);
        container.appendChild(span);
    }
    updateTokenDisplay();
}
function toggleCharSelection(index){
    const el = document.querySelector(`[data-index="${index}"]`);
    if (selectedChars.includes(index)){
        selectedChars = selectedChars.filter(i=>i!==index);
        el.classList.remove('selected-char');
    } else {
        selectedChars.push(index);
        el.classList.add('selected-char');
    }
    selectedChars.sort((a,b)=>a-b);
}
function markTokenBoundary(){
    if (selectedChars.length===0){ alert('í† í°ìœ¼ë¡œ ë§Œë“¤ ë¬¸ìë“¤ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
    let tokenText='';
    selectedChars.forEach(i=>{
        tokenText += currentSentence[i];
        const el = document.querySelector(`[data-index="${i}"]`);
        el.classList.remove('selected-char');
        el.classList.add('token-boundary');
        el.onclick = null;
    });
    if (tokenText.trim()) currentTokens.push(tokenText.trim());
    selectedChars=[];
    updateTokenDisplay();
    checkTokenizationComplete();
}
function updateTokenDisplay(){
    const container = document.getElementById('tokenDisplay');
    container.innerHTML='';
    if (currentTokens.length===0){
        const p=document.createElement('p'); p.style.color='#666'; p.textContent='ì•„ì§ ìƒì„±ëœ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.'; container.appendChild(p); return;
    }
    currentTokens.forEach((tok,idx)=>{
        const div=document.createElement('div');
        div.className='token';
        div.textContent = `${idx+1}. ${tok}`;
        div.title = 'í´ë¦­í•˜ì—¬ ì œê±°';
        div.onclick = ()=>removeToken(idx);
        container.appendChild(div);
    });
}
function removeToken(i){ currentTokens.splice(i,1); updateTokenDisplay(); setupClickableSentence(); }
function undoLastToken(){ if (currentTokens.length>0) removeToken(currentTokens.length-1); }
function resetTokenization(){ setupClickableSentence(); }

// ìë™ í† í°í™” í•¨ìˆ˜
function autoTokenize(){
    if (currentTokens.length > 0){
        const confirmReset = confirm('ì´ë¯¸ í† í°í™”ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ì²˜ìŒë¶€í„° ìë™ìœ¼ë¡œ ë‹¤ì‹œ í† í°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        if (!confirmReset) return;
    }
    
    // ì´ˆê¸°í™”
    setupClickableSentence();
    
    // ìë™ í† í°í™” ë¡œì§ (í•œêµ­ì–´ ê¸°ë°˜)
    const autoTokens = performAutoTokenization(currentSentence);
    
    // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¡œ í† í° í•˜ë‚˜ì”© ì¶”ê°€
    let tokenIndex = 0;
    const addTokenWithAnimation = () => {
        if (tokenIndex < autoTokens.length) {
            const token = autoTokens[tokenIndex];
            
            // í•´ë‹¹ í† í°ì˜ ë¬¸ìë“¤ì„ ì‹œê°ì ìœ¼ë¡œ ì„ íƒ
            highlightTokenInSentence(token, tokenIndex);
            
            setTimeout(() => {
                currentTokens.push(token);
                updateTokenDisplay();
                tokenIndex++;
                addTokenWithAnimation();
            }, 800); // 0.8ì´ˆë§ˆë‹¤ í† í° ì¶”ê°€
        } else {
            // ëª¨ë“  í† í°í™” ì™„ë£Œ
            checkTokenizationComplete();
            showAutoTokenizationComplete();
        }
    };
    
    // ìë™ í† í°í™” ì‹œì‘ ë©”ì‹œì§€
    showAutoTokenizationStart();
    setTimeout(addTokenWithAnimation, 1000);
}

// ì‹¤ì œ ìë™ í† í°í™” ë¡œì§
function performAutoTokenization(sentence){
    // í•œêµ­ì–´ í† í°í™” ê·œì¹™ (ê°„ë‹¨í•œ ë²„ì „)
    const tokens = [];
    
    // ë¬¸ì¥ë¶€í˜¸ì™€ ê³µë°± ê¸°ì¤€ìœ¼ë¡œ 1ì°¨ ë¶„ë¦¬
    const words = sentence.replace(/([.!?])/g, ' $1 ').split(/\s+/).filter(w => w.trim());
    
    words.forEach(word => {
        if (word.match(/[.!?]/)) {
            // ë¬¸ì¥ë¶€í˜¸ëŠ” ë³„ë„ í† í°
            tokens.push(word);
        } else if (word.length <= 2) {
            // ì§§ì€ ë‹¨ì–´ëŠ” ê·¸ëŒ€ë¡œ
            tokens.push(word);
        } else {
            // ê¸´ ë‹¨ì–´ëŠ” ì˜ë¯¸ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ ì‹œë„
            const subTokens = smartTokenSplit(word);
            tokens.push(...subTokens);
        }
    });
    
    return tokens.filter(t => t.trim());
}

// ìŠ¤ë§ˆíŠ¸ í† í° ë¶„ë¦¬ (í•œêµ­ì–´ íŒ¨í„´ ê³ ë ¤)
function smartTokenSplit(word) {
    // ì¡°ì‚¬ë‚˜ ì–´ë¯¸ ë¶„ë¦¬ íŒ¨í„´ (ë” ì—„ê²©í•œ ì¡°ê±´)
    const patterns = [
        // ì¡°ì‚¬ (ëª…ì‚¬ ë’¤ì— ë¶™ëŠ” ê²½ìš°ë§Œ)
        /^(.{2,})(ì€|ëŠ”|ì´|ê°€|ì„|ë¥¼|ì—ì„œ|ì—ê²Œ|ìœ¼ë¡œ|ë¡œ|ì˜|ê³¼|ì™€|ë„|ë§Œ|ë¶€í„°|ê¹Œì§€)$/, 
        // ë™ì‚¬/í˜•ìš©ì‚¬ ì–´ë¯¸ (ì–´ê°„ì´ 2ê¸€ì ì´ìƒì¸ ê²½ìš°ë§Œ)
        /^(.{2,})(ì—ˆë‹¤|ì•˜ë‹¤|ê² ë‹¤|ìŠµë‹ˆë‹¤|ã…‚ë‹ˆë‹¤)$/, 
        // ë³´ì¡°ë™ì‚¬ (ëª…ì‚¬ ë’¤ì— ë¶™ëŠ” ê²½ìš°ë§Œ)
        /^(.{2,})(í•˜ë‹¤|ë˜ë‹¤|ì´ë‹¤)$/
    ];
    
    for (const pattern of patterns) {
        const match = word.match(pattern);
        if (match && match[1].length >= 2) {
            // ë¶„ë¦¬ëœ ì–´ê°„ì´ ì˜ë¯¸ê°€ ìˆëŠ”ì§€ ì¶”ê°€ ê²€ì¦
            const stem = match[1];
            const suffix = match[2];
            
            // 'ë‹¤'ë§Œ ë‹¨ë…ìœ¼ë¡œ ë¶„ë¦¬ë˜ëŠ” ê²ƒì„ ë°©ì§€
            if (suffix === 'ë‹¤' && stem.length < 2) {
                continue;
            }
            
            // ì¼ë°˜ì ì¸ ë‹¨ì–´ë“¤ì€ ë¶„ë¦¬í•˜ì§€ ì•ŠìŒ
            const dontSplit = ['ê·¸ëŸ°ë°', 'ê·¸ë¦¬ê³ ', 'í•˜ì§€ë§Œ', 'ê·¸ë˜ì„œ', 'ë˜í•œ', 'ì–´ì œ', 'ì˜¤ëŠ˜', 'ë‚´ì¼'];
            if (dontSplit.includes(word)) {
                continue;
            }
            
            return [stem, suffix];
        }
    }
    
    // íŒ¨í„´ì— ë§ì§€ ì•Šê±°ë‚˜ ë¶„ë¦¬ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•Šìœ¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
    return [word];
}

// í† í°ì„ ë¬¸ì¥ì—ì„œ ì‹œê°ì ìœ¼ë¡œ ê°•ì¡°
function highlightTokenInSentence(token, tokenIndex) {
    const container = document.getElementById('clickableSentence');
    const spans = container.querySelectorAll('.clickable-char');
    
    // í† í° ìœ„ì¹˜ ì°¾ê¸°
    let searchStart = 0;
    for (let i = 0; i < tokenIndex; i++) {
        const prevToken = currentTokens[i] || '';
        searchStart = currentSentence.indexOf(prevToken, searchStart) + prevToken.length;
    }
    
    const tokenStart = currentSentence.indexOf(token, searchStart);
    if (tokenStart !== -1) {
        // í•´ë‹¹ ë²”ìœ„ì˜ ë¬¸ìë“¤ì„ ê°•ì¡°
        for (let i = tokenStart; i < tokenStart + token.length; i++) {
            if (spans[i]) {
                spans[i].classList.add('token-boundary');
                spans[i].style.animation = 'pulse 0.5s ease';
            }
        }
    }
}

// ìë™ í† í°í™” ì‹œì‘ ë©”ì‹œì§€
function showAutoTokenizationStart() {
    const container = document.getElementById('tokenContainer');
    const startMsg = document.createElement('div');
    startMsg.id = 'autoTokenMsg';
    startMsg.style.cssText = 'background: linear-gradient(45deg, #2196f3, #1976d2); color: white; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; font-weight: bold; animation: fadeIn 0.5s ease;';
    startMsg.innerHTML = 'ğŸ¤– AIê°€ ìë™ìœ¼ë¡œ í† í°í™”ë¥¼ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...<br><small style="font-weight: normal; margin-top: 5px; display: block;">í•œêµ­ì–´ ì–¸ì–´ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ì˜ë¯¸ ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.</small>';
    
    container.insertBefore(startMsg, container.firstChild);
}

// ìë™ í† í°í™” ì™„ë£Œ ë©”ì‹œì§€
function showAutoTokenizationComplete() {
    const autoMsg = document.getElementById('autoTokenMsg');
    if (autoMsg) {
        autoMsg.style.background = 'linear-gradient(45deg, #4caf50, #45a049)';
        autoMsg.innerHTML = 'âœ… ìë™ í† í°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!<br><small style="font-weight: normal; margin-top: 5px; display: block;">ìƒì„±ëœ í† í°ë“¤ì„ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>';
        
        // 3ì´ˆ í›„ ë©”ì‹œì§€ ì œê±°
        setTimeout(() => {
            if (autoMsg) autoMsg.remove();
        }, 3000);
    }
}

function checkTokenizationComplete(){ if (currentTokens.length>0) document.getElementById('embeddingBtn').disabled=false; }

/* =========================
   Step3: ì„ë² ë”© + 3D
   ========================= */
// ì„ë² ë”© ëª¨ë“œ ì „í™˜
function switchEmbeddingMode(useReal) {
    useRealEmbeddings = useReal;
    
    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
    const simpleBtn = document.getElementById('simpleEmbBtn');
    const realBtn = document.getElementById('realEmbBtn');
    const infoDiv = document.getElementById('embeddingModeInfo');
    
    if (useReal) {
        simpleBtn.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
        realBtn.style.background = 'linear-gradient(45deg, #4caf50, #45a049)';
        realBtn.style.transform = 'scale(1.05)';
        simpleBtn.style.transform = 'scale(1)';
        infoDiv.innerHTML = 'í˜„ì¬: ğŸš€ ì‹¤ì œ ëª¨ë¸ ì„ë² ë”© (FastText í•œêµ­ì–´ ëª¨ë¸ ê¸°ë°˜, PCA ì¶•ì†Œ)';
        infoDiv.style.color = '#4caf50';
    } else {
        realBtn.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
        simpleBtn.style.background = 'linear-gradient(45deg, #4caf50, #45a049)';
        simpleBtn.style.transform = 'scale(1.05)';
        realBtn.style.transform = 'scale(1)';
        infoDiv.innerHTML = 'í˜„ì¬: ğŸ“š êµìœ¡ìš© ê°„ë‹¨ ì„ë² ë”© (ì˜ë¯¸ ê·¸ë£¹ ê¸°ë°˜)';
        infoDiv.style.color = '#666';
    }
    
    // ì´ë¯¸ ì„ë² ë”©ì´ ìƒì„±ëœ ê²½ìš° ì¬ìƒì„±
    if (currentTokens.length > 0) {
        showEmbeddings();
    }
}

function proceedToEmbedding(){
    if (currentTokens.length===0){ alert('ë¨¼ì € í† í°í™”ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”!'); return; }
    activateStep(3);
    showEmbeddings();
}
function showEmbeddings(){
    const cont = document.getElementById('embeddingGrid');
    cont.innerHTML=''; embeddings={}; wordColors={};
    const colors=['#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FFEAA7','#DDA0DD','#98D8C8','#F7DC6F'];
    currentTokens.forEach((tok,idx)=>{
        setTimeout(()=>{
            const emb = generateEmbedding(tok);
            embeddings[tok]=emb; wordColors[tok]=colors[idx%colors.length];
            const card = createEmbeddingCard(tok, emb);
            cont.appendChild(card);
            if (idx===currentTokens.length-1){
                setTimeout(()=>{ setup3DVisualization(); document.getElementById('rnnBtn').disabled=false; }, 500);
            }
        }, idx*400);
    });
}
function createEmbeddingCard(word, vec){
    const card=document.createElement('div'); card.className='embedding-card fade-in';
    const wordDiv=document.createElement('div'); wordDiv.className='embedding-word'; wordDiv.textContent=word;
    
    // ì„ë² ë”© íƒ€ì… í‘œì‹œ
    const typeDiv=document.createElement('div');
    const isRealEmb = useRealEmbeddings && realWordEmbeddings[word];
    typeDiv.style.cssText = `font-size: 0.8em; margin-bottom: 8px; padding: 4px 8px; border-radius: 12px; display: inline-block; font-weight: bold;`;
    if (isRealEmb) {
        typeDiv.textContent = 'ğŸš€ FastText';
        typeDiv.style.background = '#4caf50';
        typeDiv.style.color = 'white';
    } else {
        typeDiv.textContent = 'ğŸ“š ê°„ë‹¨ ëª¨ë“œ';
        typeDiv.style.background = '#e0e0e0';
        typeDiv.style.color = '#666';
    }
    
    const vDiv=document.createElement('div'); vDiv.className='vector-display'; vDiv.textContent='['+vec.map(v=>v.toFixed(2)).join(', ')+']';
    const bars=document.createElement('div'); bars.style.marginTop='10px';
    vec.forEach(v=>{
        const bar=document.createElement('div'); bar.className='dimension-bar';
        const fill=document.createElement('div'); fill.className='dimension-fill'; fill.style.width = `${Math.abs(v)*50 + 50}%`;
        bar.appendChild(fill); bars.appendChild(bar);
    });
    card.appendChild(wordDiv); card.appendChild(typeDiv); card.appendChild(vDiv); card.appendChild(bars);
    return card;
}

// 3D ì‹œê°í™”
function setup3DVisualization(){
    canvas3D = document.getElementById('embedding3DCanvas');
    ctx3D = canvas3D.getContext('2d');
    let dragging=false, lastX=0, lastY=0;
    canvas3D.addEventListener('mousedown', e=>{ dragging=true; lastX=e.clientX; lastY=e.clientY; });
    canvas3D.addEventListener('mousemove', e=>{
        if (!dragging) return;
        const dx = e.clientX - lastX, dy = e.clientY - lastY;
        rotation3D.y += dx*0.01; rotation3D.x += dy*0.01;
        draw3DSpace(); lastX=e.clientX; lastY=e.clientY;
    });
    canvas3D.addEventListener('mouseup', ()=> dragging=false);
    draw3DSpace(); createWordLegend();
}
function drawAxes(){
    ctx3D.strokeStyle='#ccc'; ctx3D.lineWidth=1;
    // X
    ctx3D.strokeStyle='#ff4444'; ctx3D.beginPath();
    let a=project3D(-150,0,0), b=project3D(150,0,0); ctx3D.moveTo(a.x,a.y); ctx3D.lineTo(b.x,b.y); ctx3D.stroke();
    // Y
    ctx3D.strokeStyle='#44ff44'; ctx3D.beginPath();
    a=project3D(0,-150,0); b=project3D(0,150,0); ctx3D.moveTo(a.x,a.y); ctx3D.lineTo(b.x,b.y); ctx3D.stroke();
    // Z
    ctx3D.strokeStyle='#4444ff'; ctx3D.beginPath();
    a=project3D(0,0,-150); b=project3D(0,0,150); ctx3D.moveTo(a.x,a.y); ctx3D.lineTo(b.x,b.y); ctx3D.stroke();

    ctx3D.fillStyle='#666'; ctx3D.font='12px Arial'; ctx3D.textAlign='center';
    const xl=project3D(170,0,0); ctx3D.fillText('X', xl.x, xl.y);
    const yl=project3D(0,170,0); ctx3D.fillText('Y', yl.x, yl.y);
    const zl=project3D(0,0,170); ctx3D.fillText('Z', zl.x, zl.y);
}
function project3D(x,y,z){
    const cx=Math.cos(rotation3D.x), sx=Math.sin(rotation3D.x);
    const cy=Math.cos(rotation3D.y), sy=Math.sin(rotation3D.y);
    const cz=Math.cos(rotation3D.z), sz=Math.sin(rotation3D.z);
    let nx = x*cy - z*sy;
    let nz = x*sy + z*cy;
    let ny = y;
    x=nx; y=ny*cx - nz*sx; z=ny*sx + nz*cx;
    nx = x*cz - y*sz; ny = x*sz + y*cz;
    return { x: canvas3D.width/2 + nx, y: canvas3D.height/2 + ny, z };
}
function draw3DSpace(){
    ctx3D.clearRect(0,0,canvas3D.width, canvas3D.height);
    ctx3D.fillStyle='#f8f9fa'; ctx3D.fillRect(0,0,canvas3D.width, canvas3D.height);
    drawAxes();
    const pts=[];
    Object.entries(embeddings).forEach(([w,e])=>{
        const x=e[0]*100, y=e[1]*100, z=e[2]*100;
        const p=project3D(x,y,z);
        pts.push({word:w, x:p.x, y:p.y, z, color:wordColors[w]});
    });
    pts.sort((a,b)=>a.z - b.z);
    pts.forEach(pt=>{
        const size=Math.max(4, 8 + pt.z*0.02);
        const alpha=Math.max(0.3, 1 + pt.z*0.003);
        ctx3D.globalAlpha = alpha;
        ctx3D.fillStyle = pt.color;
        ctx3D.beginPath(); ctx3D.arc(pt.x, pt.y, size, 0, Math.PI*2); ctx3D.fill();
        ctx3D.fillStyle='#333'; ctx3D.font=`${Math.max(10, 12 + pt.z*0.01)}px Arial`;
        ctx3D.textAlign='center'; ctx3D.fillText(pt.word, pt.x, pt.y - size - 5);
    });
    ctx3D.globalAlpha=1;
}
function createWordLegend(){
    const c = document.getElementById('wordLegend'); c.innerHTML='';
    Object.entries(wordColors).forEach(([w,color])=>{
        const item=document.createElement('div'); item.className='legend-item';
        const dot=document.createElement('div'); dot.className='legend-color'; dot.style.background=color;
        const span=document.createElement('span'); span.textContent=w;
        item.appendChild(dot); item.appendChild(span); c.appendChild(item);
    });
}
function rotate3DView(axis){
    const ang = Math.PI/6;
    if (axis==='x') rotation3D.x += ang;
    if (axis==='y') rotation3D.y += ang;
    if (axis==='z') rotation3D.z += ang;
    draw3DSpace();
}
function reset3DView(){ rotation3D={x:0,y:0,z:0}; draw3DSpace(); }
function updateVisualizationWithNewWord(word){ if (canvas3D && ctx3D){ createWordLegend(); draw3DSpace(); setTimeout(()=>highlightWordIn3D(word),500);} }
function highlightWordIn3D(target){
    const e=embeddings[target]; if (!e) return;
    const p=project3D(e[0]*100, e[1]*100, e[2]*100);
    let t=0; const iv=setInterval(()=>{
        draw3DSpace();
        const size=15 + Math.sin(t*0.5)*5;
        ctx3D.strokeStyle='#ff4444'; ctx3D.lineWidth=3;
        ctx3D.beginPath(); ctx3D.arc(p.x,p.y,size,0,Math.PI*2); ctx3D.stroke();
        t++; if (t>20){ clearInterval(iv); draw3DSpace(); }
    },100);
}

/* =========================
   OOV ì²˜ë¦¬
   ========================= */
function processNewWord(){
    const newWord = document.getElementById('newWordInput').value.trim();
    const rc = document.getElementById('oovResult');
    if (!newWord){ alert('ìƒˆë¡œìš´ ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
    if (embeddings[newWord]){
        rc.innerHTML=''; const w=document.createElement('div');
        w.style.cssText='color:#ff9800; font-weight:bold;'; w.textContent=`"${newWord}"ëŠ” ì´ë¯¸ í•™ìŠµëœ ë‹¨ì–´ì…ë‹ˆë‹¤!`;
        rc.appendChild(w); return;
    }
    rc.innerHTML=''; const loading=document.createElement('div');
    loading.style.textAlign='center'; loading.textContent='ìƒˆë¡œìš´ ë‹¨ì–´ ì„ë² ë”© ìƒì„± ì¤‘...'; rc.appendChild(loading);

    setTimeout(()=>{
        const res = generateOOVEmbedding(newWord);
        embeddings[newWord] = res.embedding;

        // ìƒ‰ìƒ í• ë‹¹
        const alt=['#FF69B4','#20B2AA','#FFA500','#9370DB','#32CD32'];
        wordColors[newWord] = alt[Object.keys(wordColors).length % alt.length];

        rc.innerHTML='';
        const title=document.createElement('h4'); title.textContent=`âœ… "${newWord}" ì„ë² ë”© ìƒì„± ì™„ë£Œ!`; rc.appendChild(title);

        const embBox=document.createElement('div');
        embBox.style.cssText='background:#f5f5f5; padding:15px; border-radius:8px; margin:15px 0;';
        const st=document.createElement('strong'); st.textContent='ìƒì„±ëœ ì„ë² ë”©:'; embBox.appendChild(st); embBox.appendChild(document.createElement('br'));
        const embText=document.createElement('span'); embText.textContent='['+res.embedding.map(v=>v.toFixed(3)).join(', ')+']';
        embBox.appendChild(embText); rc.appendChild(embBox);

        if (res.similarWords.length>0){
            const simDiv=document.createElement('div'); simDiv.style.margin='15px 0';
            const simTitle=document.createElement('strong'); simTitle.textContent='ì°¸ê³ í•œ ìœ ì‚¬ ë‹¨ì–´ë“¤:'; simDiv.appendChild(simTitle);
            const ul=document.createElement('ul');
            res.similarWords.forEach(s=>{
                const li=document.createElement('li'); li.style.margin='8px 0';
                const lvl = s.similarity>0.6 ? 'high' : s.similarity>0.3 ? 'medium' : 'low';
                const txt = s.similarity>0.6 ? 'ë†’ìŒ' : s.similarity>0.3 ? 'ë³´í†µ' : 'ë‚®ìŒ';
                li.textContent=`"${s.word}" `;
                const badge=document.createElement('span'); badge.className=`similarity-indicator ${lvl}-similarity`;
                badge.textContent=`${txt} (${(s.similarity*100).toFixed(1)}%)`;
                li.appendChild(badge); ul.appendChild(li);
            });
            simDiv.appendChild(ul); rc.appendChild(simDiv);

            const m=document.createElement('div');
            m.style.cssText='background:#e8f5e8; padding:12px; border-radius:8px; margin:15px 0;';
            const mi=document.createElement('strong'); mi.textContent='ğŸ’¡ ë°©ë²•: ';
            const mt=document.createElement('span'); mt.textContent='ìœ ì‚¬í•œ ë‹¨ì–´ë“¤ì˜ ì„ë² ë”©ì„ ê°€ì¤‘í‰ê· í•˜ì—¬ ìƒˆë¡œìš´ ì„ë² ë”©ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.';
            m.appendChild(mi); m.appendChild(mt); rc.appendChild(m);
        } else {
            const m=document.createElement('div');
            m.style.cssText='background:#fff3e0; padding:12px; border-radius:8px; margin:15px 0;';
            const mi=document.createElement('strong'); mi.textContent='ğŸ’¡ ë°©ë²•: ';
            const mt=document.createElement('span'); mt.textContent='ìœ ì‚¬ ë‹¨ì–´ë¥¼ ì°¾ì§€ ëª»í•´ ê¸°ë³¸ ì„ë² ë”©ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.';
            m.appendChild(mi); m.appendChild(mt); rc.appendChild(m);
        }

        const btns=document.createElement('div'); btns.style.cssText='text-align:center; margin:15px 0;';
        const vBtn=document.createElement('button'); vBtn.textContent='3D ì‹œê°í™”ì— ì¶”ê°€í•˜ê¸°';
        vBtn.style.cssText='background:#4caf50; color:#fff; border:none; padding:10px 20px; border-radius:20px; cursor:pointer;';
        vBtn.onclick=()=>updateVisualizationWithNewWord(newWord);
        const tBtn=document.createElement('button'); tBtn.textContent='ì˜ˆì¸¡ í…ŒìŠ¤íŠ¸í•˜ê¸°';
        tBtn.style.cssText='background:#2196f3; color:#fff; border:none; padding:10px 20px; border-radius:20px; cursor:pointer; margin-left:10px;';
        tBtn.onclick=()=>{ if (!document.getElementById('step5').classList.contains('active')) activateStep(5); document.getElementById('predictionInput').value=newWord; predictNext(); };
        btns.appendChild(vBtn); btns.appendChild(tBtn); rc.appendChild(btns);

        document.getElementById('newWordInput').value='';
    },1500);
}

/* =========================
   Step4: RNN ìˆœì°¨ ì²˜ë¦¬
   ========================= */
function proceedToRNN(){ activateStep(4); processRNNSequentially(); }
function processRNNSequentially(){
    const cont=document.getElementById('rnnContainer'); cont.innerHTML='';
    const title=document.createElement('h4'); title.textContent='RNNì´ ê° í† í°ì„ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤:'; cont.appendChild(title);
    
    // RNN ì°¨ì› ì„¤ì • ì•ˆë‚´
    const dimInfo=document.createElement('div');
    dimInfo.style.cssText='background:#fff3e0; padding:15px; border-radius:10px; margin:15px 0; border-left:4px solid #ff9800;';
    dimInfo.innerHTML=`
        <strong>ğŸ”§ RNN ì²˜ë¦¬ ë°©ì‹:</strong><br>
        â€¢ <strong>ì…ë ¥:</strong> 5ì°¨ì› ì„ë² ë”© ë²¡í„°<br>
        â€¢ <strong>Hidden State:</strong> 5ì°¨ì› (ì…ë ¥ê³¼ ë™ì¼í•œ í¬ê¸° ìœ ì§€)<br>
        â€¢ <strong>ì²˜ë¦¬:</strong> í˜„ì¬ ì…ë ¥ + ì´ì „ ìƒíƒœ â†’ ìƒˆë¡œìš´ ìƒíƒœ<br>
        <small style="color:#666;">ğŸ’¡ ì‹¤ì œ RNNì€ ì •ë³´ ì†ì‹¤ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ ì…ë ¥ ì°¨ì›ê³¼ ê°™ê±°ë‚˜ ë” í° Hidden Stateë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</small>
    `;
    cont.appendChild(dimInfo);

    hiddenStates=[]; memoryBank=[]; learnedModel={};
    let idx=0;
    function next(){
        if (idx<currentTokens.length){
            const tok=currentTokens[idx], vec=embeddings[tok];

            const step=document.createElement('div'); step.className='rnn-step active fade-in';
            const prev = hiddenStates.length>0 ? hiddenStates[hiddenStates.length-1] : [0,0,0,0,0];
            // ì‹¤ì œ RNN ê³„ì‚°: í˜„ì¬ ì…ë ¥ê³¼ ì´ì „ hidden state ê²°í•©
            const newH = vec.map((v,i)=>(v*0.6 + prev[i]*0.4).toFixed(2)); // ê°€ì¤‘ ê²°í•©
            hiddenStates.push(newH);

            const inV=document.createElement('div'); inV.className='input-vector';
            const it=document.createElement('strong'); it.textContent=tok;
            const ibr=document.createElement('br');
            const iv=document.createElement('span'); iv.textContent='['+vec.map(v=>v.toFixed(2)).join(', ')+']';
            inV.appendChild(it); inV.appendChild(ibr); inV.appendChild(iv);

            const a1=document.createElement('div'); a1.className='arrow'; a1.textContent='â†’';

            const cell=document.createElement('div'); cell.className='rnn-cell'; cell.textContent='RNN';
            const cbr=document.createElement('br'); const small=document.createElement('small'); small.textContent='ê°€ì¤‘ ê²°í•© ì²˜ë¦¬...';
            cell.appendChild(cbr); cell.appendChild(small);

            const a2=document.createElement('div'); a2.className='arrow'; a2.textContent='â†’';

            const hS=document.createElement('div'); hS.className='hidden-state';
            const ht=document.createElement('span'); ht.textContent='Hidden State';
            const hbr=document.createElement('br'); const hv=document.createElement('span'); hv.textContent='['+newH.join(', ')+']';
            hS.appendChild(ht); hS.appendChild(hbr); hS.appendChild(hv);

            step.appendChild(inV); step.appendChild(a1); step.appendChild(cell); step.appendChild(a2); step.appendChild(hS);
            cont.appendChild(step);

            // ê°„ë‹¨ 'í•™ìŠµ' : í˜„ì¬ ë‹¨ì–´ -> ë‹¤ìŒ ë‹¨ì–´ ìˆ˜ì§‘
            if (idx<currentTokens.length-1){
                const nextTok=currentTokens[idx+1];
                if (!learnedModel[tok]) learnedModel[tok]=[];
                learnedModel[tok].push(nextTok);
            }

            updateMemoryBank(tok);
            idx++;
            step.scrollIntoView({behavior:'smooth', block:'center'});
            setTimeout(next, 2000);
        } else {
            setTimeout(()=>{ document.getElementById('predictionBtn').disabled=false; highlightLongTermDependency(); }, 1000);
        }
    }
    next();
}
function updateMemoryBank(token){
    memoryBank.push(token);
    if (memoryBank.length>memoryCapacity) memoryBank.shift();

    const md=document.getElementById('memoryDisplay'); md.innerHTML='';
    if (memoryBank.length===0){ const sp=document.createElement('span'); sp.style.color='#666'; sp.textContent='ì•„ì§ ì²˜ë¦¬ ì‹œì‘ ì „ì…ë‹ˆë‹¤'; md.appendChild(sp); return; }

    memoryBank.forEach((w,idx)=>{
        const mi=document.createElement('div'); mi.className='memory-item'; mi.textContent=w;
        const st=document.createElement('div'); st.className='memory-strength'; st.style.width = `${100 - (memoryBank.length-idx-1)*30}%`; mi.appendChild(st);
        if (idx < memoryBank.length-2) mi.classList.add('fading');
        md.appendChild(mi);
    });
}
function highlightLongTermDependency(){
    const steps=document.querySelectorAll('.rnn-step');
    steps.forEach((st,idx)=>{
        const tok=currentTokens[idx];
        if (tok && (tok.includes('ê·¸ê²ƒ')||tok.includes('ì´ê²ƒ')||tok.includes('ì €ê²ƒ'))){
            st.style.border='3px solid #f44336'; st.style.background='#ffebee';
            const refs=['ì±…','ìŠ¤ë§ˆíŠ¸í°','ì‚¬ê³¼','ê³µ','ì°¨'];
            const hasRef = refs.some(r => memoryBank.some(m=>m.includes(r)));
            if (!hasRef){
                const warn=document.createElement('div');
                warn.style.cssText='background:#f44336;color:#fff;padding:10px;border-radius:5px;margin-top:10px;text-align:center;font-weight:bold;';
                warn.textContent='âš ï¸ ì°¸ì¡° ëŒ€ìƒì„ ê¸°ì–µí•˜ì§€ ëª»í•©ë‹ˆë‹¤!';
                st.appendChild(warn);
            }
        }
    });
}

/* =========================
   Step5: ì˜ˆì¸¡
   ========================= */
function proceedToPrediction(){ activateStep(5); }
function predictNext(){
    const input = document.getElementById('predictionInput').value.trim();
    const rc = document.getElementById('predictionResult');
    if (!input){ alert('ì˜ˆì¸¡í•  ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
    rc.innerHTML='<div style="text-align:center;">ì˜ˆì¸¡ ì¤‘...</div>';
    setTimeout(()=>{
        const preds = generatePredictions(input);
        displayPredictions(preds, input);
    }, 1000);
}
function generatePredictions(w){
    const preds=[];
    if (!embeddings[w]){
        const oov = generateOOVEmbedding(w);
        embeddings[w]=oov.embedding;
        preds.push({ word:'[ìƒˆë¡œìš´ ë‹¨ì–´ ì²˜ë¦¬ë¨]', confidence:0.8, source:'oov_processed',
            details:`"${w}"ëŠ” ìƒˆë¡œìš´ ë‹¨ì–´ë¡œ ìœ ì‚¬ ë‹¨ì–´ë¥¼ ì°¸ê³ í•˜ì—¬ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`});
    }
    if (learnedModel[w]){
        const nxt=learnedModel[w]; const cnt={};
        nxt.forEach(x=>{ cnt[x]=(cnt[x]||0)+1; });
        Object.entries(cnt).forEach(([word, c])=>{
            preds.push({ word, confidence: c/nxt.length, source:'direct' });
        });
    }
    if (embeddings[w]){
        Object.keys(embeddings).forEach(t=>{
            if (t!==w && t.length>1){
                const s = calculateEmbeddingSimilarity(w,t);
                if (s>0.4 && learnedModel[t]){
                    learnedModel[t].forEach(nw=>{
                        preds.push({ word:nw, confidence: s*0.6, source:'embedding_similarity',
                            details:`"${t}"ì™€ ìœ ì‚¬í•˜ì—¬ ì˜ˆì¸¡ë¨ (ìœ ì‚¬ë„: ${(s*100).toFixed(1)}%)` });
                    });
                }
            }
        });
    }
    const g=findSemanticGroup(w);
    if (g!=='ê¸°íƒ€'){
        const gw=semanticGroups[g]||[];
        gw.forEach(ww=>{
            if (learnedModel[ww]){
                learnedModel[ww].forEach(nw=>{
                    preds.push({ word:nw, confidence:0.4, source:'semantic_group',
                        details:`ê°™ì€ ì˜ë¯¸ ê·¸ë£¹("${g}")ì˜ ë‹¨ì–´ë“¤ë¡œë¶€í„° ì˜ˆì¸¡` });
                });
            }
        });
    }
    const commonNext={
        'ì±…':['ì„','ì´','ì„ì½ì—ˆë‹¤','ì´ì¬ë¯¸ìˆë‹¤'],
        'ê·¸ê²ƒ':['ì´','ì„','ì˜','ê³¼'],
        'ì² ìˆ˜':['ëŠ”','ê°€','ì™€','ì˜'],
        'ë„ì„œê´€':['ì—ì„œ','ì—','ì˜','ì„'],
        'ì»´í“¨í„°':['ë¥¼','ê°€','ë¡œ','ì—ì„œ'],
        'ì‚¬ë‘':['ì€','ì´','ì„','í•˜ë‹¤'],
        'í–‰ë³µ':['í•œ','í•˜ë‹¤','ì´','ì„']
    };
    Object.keys(commonNext).forEach(k=>{
        if (w.includes(k) || k.includes(w)){
            commonNext[k].forEach(nw=> preds.push({ word:nw, confidence:0.5, source:'common_pattern' }) );
        }
    });

    // ì¤‘ë³µ ì •ë¦¬
    const uniq={};
    preds.forEach(p=>{
        if (uniq[p.word]){
            uniq[p.word].confidence = Math.max(uniq[p.word].confidence, p.confidence);
            if (p.details) uniq[p.word].details = p.details;
        } else uniq[p.word]=p;
    });
    return Object.values(uniq).sort((a,b)=>b.confidence - a.confidence).slice(0,6);
}
function displayPredictions(preds, input){
    const c=document.getElementById('predictionResult');
    if (preds.length===0){
        c.innerHTML = `<div style="text-align:center; color:#f44336;"><strong>"${input}"</strong>ì— ëŒ€í•œ ì˜ˆì¸¡ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><small>í•™ìŠµ ë°ì´í„°ê°€ ë¶€ì¡±í•˜ê±°ë‚˜ ë‹¨ì–´ë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</small></div>`;
        return;
    }
    c.innerHTML='';
    const h=document.createElement('h4'); h.textContent=`"${input}" ë‹¤ìŒì— ì˜¬ ë‹¨ì–´ ì˜ˆì¸¡:`; c.appendChild(h);

    if (preds.some(p=>p.source==='oov_processed')){
        const o=document.createElement('div');
        o.style.cssText='background:#fff3e0; padding:15px; border-radius:10px; margin:15px 0; border-left:4px solid #ff9800;';
        o.innerHTML=`<strong>ğŸ†• ìƒˆë¡œìš´ ë‹¨ì–´ ê°ì§€!</strong><br>"${input}"ëŠ” í•™ìŠµë˜ì§€ ì•Šì€ ìƒˆë¡œìš´ ë‹¨ì–´ì…ë‹ˆë‹¤. ìœ ì‚¬í•œ ë‹¨ì–´ë“¤ì„ ì°¸ê³ í•˜ì—¬ ì˜ˆì¸¡ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.`;
        c.appendChild(o);
    }

    preds.forEach((p,i)=>{
        if (p.source==='oov_processed') return;
        const conf=(p.confidence*100).toFixed(1);
        const srcMap={'direct':'ì§ì ‘ í•™ìŠµ','embedding_similarity':'ì„ë² ë”© ìœ ì‚¬ë„','semantic_group':'ì˜ë¯¸ ê·¸ë£¹','common_pattern':'ì¼ë°˜ íŒ¨í„´','similarity':'ìœ ì‚¬ë„ ê¸°ë°˜'};
        const src=srcMap[p.source]||'ê¸°íƒ€';

        const box=document.createElement('div'); box.style.cssText='margin:15px 0; padding:15px; background:#f8f9fa; border-radius:10px;';
        const w=document.createElement('div'); w.className='predicted-word'; w.textContent=`${i+1}. ${p.word}`;
        const bar=document.createElement('div'); bar.className='confidence-bar';
        const fill=document.createElement('div'); fill.className='confidence-fill'; fill.style.width=`${conf}%`; fill.textContent=`${conf}% í™•ì‹ `;
        bar.appendChild(fill);

        const det=document.createElement('div'); det.style.marginTop='10px';
        det.innerHTML = `<small style="color:#666;"><strong>ì¶œì²˜:</strong> ${src}${p.details?`<br><strong>ì„¸ë¶€ì‚¬í•­:</strong> ${p.details}`:''}</small>`;

        box.appendChild(w); box.appendChild(bar); box.appendChild(det);
        c.appendChild(box);
    });

    const avg = preds.reduce((s,p)=>s+p.confidence,0)/preds.length;
    let col='#f44336', txt='ë‚®ìŒ';
    if (avg>0.6){ col='#4caf50'; txt='ë†’ìŒ'; }
    else if (avg>0.3){ col='#ff9800'; txt='ë³´í†µ'; }

    const q=document.createElement('div');
    q.style.cssText='background:#e3f2fd; padding:15px; border-radius:10px; margin:20px 0; text-align:center;';
    q.innerHTML = `<strong>ğŸ“Š ì˜ˆì¸¡ í’ˆì§ˆ:</strong> <span style="color:${col}; font-weight:bold;">${txt}</span><span style="color:#666; font-size:0.9em;"> (í‰ê·  í™•ì‹ ë„: ${(avg*100).toFixed(1)}%)</span>`;
    c.appendChild(q);
}

/* =========================
   ë¬¸ì œ ìƒí™© í…ŒìŠ¤íŠ¸/ê°•ì¡°
   ========================= */
function testProblemCases(){
    const tests=[
        { input:'ê·¸ê²ƒ', expected:'ì±…', description:'"ê·¸ê²ƒ"ì´ "ì±…"ì„ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸ (ì¥ê¸° ì˜ì¡´ì„±)' },
        { input:'ì±…', expected:'ì„', description:'"ì±…" ë‹¤ìŒì— ì˜¬ ì¡°ì‚¬ ì˜ˆì¸¡' },
        { input:'ì»´í“¨í„°', expected:'ìƒˆë¡œìš´ ë‹¨ì–´', description:'í•™ìŠµí•˜ì§€ ì•Šì€ ìƒˆë¡œìš´ ë‹¨ì–´ ì²˜ë¦¬ (OOV)' },
        { input:'í–‰ë³µ', expected:'ê°ì • ê´€ë ¨', description:'ì˜ë¯¸ ê·¸ë£¹ ê¸°ë°˜ ìƒˆ ë‹¨ì–´ ì˜ˆì¸¡ (OOV)' }
    ];
    const pd = document.getElementById('problemDetails');
    pd.innerHTML='';
    const intro=document.createElement('p'); intro.textContent='ë‹¤ìŒ í…ŒìŠ¤íŠ¸ë“¤ì„ ìˆ˜í–‰í•´ì„œ RNNì˜ í•œê³„ì™€ ê°œì„ ì ì„ í™•ì¸í•´ë³´ì„¸ìš”:'; pd.appendChild(intro);

    const ul=document.createElement('ul');
    tests.forEach(tc=>{
        const preds = generatePredictions(tc.input);
        let ok=false, msg='';
        if (tc.input==='ê·¸ê²ƒ'){
            ok = preds.some(p=>p.word.includes('ì±…')||p.word.includes('ì„')||p.word.includes('ì´'));
            msg = ok ? 'âœ… ì¼ë¶€ ì˜ˆì¸¡ ê°€ëŠ¥' : 'âŒ ì°¸ì¡° ëŒ€ìƒ ì—°ê²° ì‹¤íŒ¨';
        } else if (tc.input==='ì±…'){
            ok = preds.some(p=>p.word.includes('ì„')||p.word.includes('ì´'));
            msg = ok ? 'âœ… ì˜¬ë°”ë¥¸ ì˜ˆì¸¡' : 'âŒ ì˜ˆì¸¡ ì‹¤íŒ¨';
        } else {
            const hasOOV = preds.some(p=>p.source==='oov_processed') || preds.length>0;
            ok = hasOOV; msg = ok ? 'âœ… OOV ì²˜ë¦¬ ì„±ê³µ' : 'âŒ OOV ì²˜ë¦¬ ì‹¤íŒ¨';
        }
        const li=document.createElement('li');
        li.style.cssText=`margin:15px 0; padding:15px; background:${ok?'#e8f5e8':'#ffebee'}; border-radius:10px;`;
        li.innerHTML = `
            <strong>${tc.description}</strong><br>
            ì…ë ¥: "${tc.input}" â†’ ì˜ˆìƒ: "${tc.expected}"<br>
            ê²°ê³¼: <span style="color:${ok?'#4caf50':'#f44336'}; font-weight:bold;">${msg}</span><br>
            <div style="margin-top:10px;">
                <button style="background:#2196f3; color:#fff; border:none; padding:8px 16px; border-radius:15px; cursor:pointer; font-size:0.9em;"
                    onclick="document.getElementById('predictionInput').value='${tc.input}'; predictNext();">
                    ì§ì ‘ í…ŒìŠ¤íŠ¸
                </button>
                ${!embeddings[tc.input] ? `
                <button style="background:#ff9800; color:#fff; border:none; padding:8px 16px; border-radius:15px; cursor:pointer; font-size:0.9em; margin-left:5px;"
                    onclick="document.getElementById('newWordInput').value='${tc.input}'; processNewWord();">
                    OOV ì²˜ë¦¬ ì‹œì—°
                </button>`:''}
            </div>
        `;
        ul.appendChild(li);
    });
    pd.appendChild(ul);

    // ì¢…í•© ë¶„ì„(ì™„ì„±)
    const analysis=document.createElement('div');
    analysis.style.cssText='background:#fff3e0; padding:20px; border-radius:15px; margin:25px 0;';
    analysis.innerHTML = `
        <h4 style="color:#ef6c00; margin-bottom:15px;">ğŸ” RNNì˜ í•œê³„ì ê³¼ ê°œì„ ì </h4>
        <ol style="margin-left:18px; line-height:1.7;">
            <li><strong>ì¥ê¸° ì˜ì¡´ì„± ë¬¸ì œ</strong>: ë©€ë¦¬ ë–¨ì–´ì§„ ë‹¨ì–´ ê°„ ê´€ê³„(ì˜ˆ: "ê·¸ê²ƒ" â†” "ì±…")ë¥¼ ìœ ì§€í•˜ê¸° ì–´ë ¤ì›€.</li>
            <li><strong>ìˆœì°¨ ì²˜ë¦¬ì˜ ë³‘ëª©</strong>: ë‹¨ì–´ë¥¼ í•œ ê°œì”© ì²˜ë¦¬í•˜ì—¬ ì†ë„ê°€ ëŠë¦¬ê³  ë³‘ë ¬í™”ê°€ ì–´ë ¤ì›€.</li>
            <li><strong>ì •ë³´ ì†Œì‹¤</strong>: ì€ë‹‰ ìƒíƒœë§Œìœ¼ë¡œ ì¤‘ìš”í•œ ì •ë³´ê°€ ë’¤ë¡œ ê°ˆìˆ˜ë¡ í¬ë¯¸í•´ì§ˆ ìˆ˜ ìˆìŒ.</li>
            <li><strong>ê°œì„  ì•„ì´ë””ì–´</strong>: ì¤‘ìš” ë¶€ë¶„ì— ì§‘ì¤‘í•˜ëŠ” <u>ì–´í…ì…˜</u> ì‚¬ìš© â†’ ì „ì²´ë¥¼ í•œ ë²ˆì— ë³´ê³  ê°€ì¤‘ì¹˜ë¡œ ì„ íƒ.</li>
            <li><strong>ë‹¤ìŒ ë‹¨ê³„ ì˜ˆê³ </strong>: ë©€í‹°-í—¤ë“œ ì–´í…ì…˜, ë ˆì´ì–´ ì •ê·œí™”, ì”ì°¨ì—°ê²° ë“±ì„ ê°€ì§„ <u>íŠ¸ëœìŠ¤í¬ë¨¸</u>ë¡œ í™•ì¥.</li>
        </ol>
    `;
    pd.appendChild(analysis);

    // ì„¹ì…˜ í‘œì‹œ ë° ìŠ¤í¬ë¡¤
    const probSec=document.getElementById('problemSection');
    probSec.style.display='block';
    probSec.scrollIntoView({behavior:'smooth', block:'start'});
}

/* =========================
   í€´ì¦ˆ ì„ íƒ ì²˜ë¦¬
   ========================= */
let quizAnswered=false;
function selectAnswer(el, correct){
    if (quizAnswered) return;
    
    const options=document.querySelectorAll('.quiz-option');
    options.forEach(o=>{
        o.classList.remove('correct','wrong');
        o.style.pointerEvents = 'none'; // ëª¨ë“  ì„ íƒì§€ ë¹„í™œì„±í™”
    });
    
    if (correct){
        // ì •ë‹µ ì„ íƒ ì‹œ
        el.classList.add('correct');
        
        // ì •ë‹µ ì¶•í•˜ ë©”ì‹œì§€ í‘œì‹œ
        const congratsDiv = document.createElement('div');
        congratsDiv.style.cssText = 'background: linear-gradient(45deg, #4caf50, #45a049); color: white; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; font-weight: bold; animation: fadeIn 0.5s ease;';
        congratsDiv.innerHTML = 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! í›Œë¥­í•´ìš”!';
        
        // í€´ì¦ˆ ì»¨í…Œì´ë„ˆì— ì¶•í•˜ ë©”ì‹œì§€ ì¶”ê°€
        const quizContainer = document.querySelector('.quiz-container');
        const explanation = document.getElementById('quizExplanation');
        quizContainer.insertBefore(congratsDiv, explanation);
        
        // ì„¤ëª… í‘œì‹œ
        setTimeout(() => {
            document.getElementById('quizExplanation').style.display='block';
        }, 1000);
        
    } else {
        // ì˜¤ë‹µ ì„ íƒ ì‹œ
        el.classList.add('wrong');
        
        // í‹€ë¦° ë‹µì— ë”°ë¥¸ êµ¬ì²´ì ì¸ íŒíŠ¸ ì œê³µ
        let hintMessage = '';
        const selectedText = el.textContent.trim();
        
        if (selectedText.includes('í† í°í™”')) {
            hintMessage = 'ğŸ’¡ íŒíŠ¸: í† í°í™”ëŠ” ì „ì²˜ë¦¬ ë‹¨ê³„ì…ë‹ˆë‹¤. RNN ìì²´ì˜ ì²˜ë¦¬ ë°©ì‹ì—ì„œ ì˜¤ëŠ” ë¬¸ì œë¥¼ ìƒê°í•´ë³´ì„¸ìš”!';
        } else if (selectedText.includes('ì›Œë“œ ì„ë² ë”©')) {
            hintMessage = 'ğŸ’¡ íŒíŠ¸: ì›Œë“œ ì„ë² ë”©ë„ ì „ì²˜ë¦¬ ë‹¨ê³„ì…ë‹ˆë‹¤. RNNì´ ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ê³  ê¸°ì–µí•˜ëŠ” ë°©ì‹ì˜ í•œê³„ë¥¼ ìƒê°í•´ë³´ì„¸ìš”!';
        } else if (selectedText.includes('ì •í™•ë„ê°€ ë„ˆë¬´ ë†’ë‹¤')) {
            hintMessage = 'ğŸ’¡ íŒíŠ¸: ì •í™•ë„ê°€ ë†’ì€ ê²ƒì€ ë¬¸ì œê°€ ì•„ë‹ˆì—ìš”! RNNì´ ë¬¸ì¥ì„ ìˆœì„œëŒ€ë¡œ ì½ì„ ë•Œ ì•ìª½ ì •ë³´ê°€ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ìƒê°í•´ë³´ì„¸ìš”.';
        } else {
            hintMessage = 'ğŸ’¡ íŒíŠ¸: RNNì€ ë‹¨ì–´ë¥¼ í•˜ë‚˜ì”© ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë¬¸ì¥ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ì²˜ìŒ ë¶€ë¶„ì˜ ì •ë³´ëŠ” ì–´ë–»ê²Œ ë ê¹Œìš”?';
        }
        
        // ì˜¤ë‹µ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
        const incorrectDiv = document.createElement('div');
        incorrectDiv.style.cssText = 'background: linear-gradient(45deg, #ff9800, #f57c00); color: white; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; font-weight: bold; animation: fadeIn 0.5s ease;';
        incorrectDiv.innerHTML = `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”!<br><small style="font-weight: normal; margin-top: 8px; display: block; line-height: 1.4;">${hintMessage}</small>`;
        
        // í€´ì¦ˆ ì»¨í…Œì´ë„ˆì— ì˜¤ë‹µ ë©”ì‹œì§€ ì¶”ê°€
        const quizContainer = document.querySelector('.quiz-container');
        const explanation = document.getElementById('quizExplanation');
        quizContainer.insertBefore(incorrectDiv, explanation);
        
        // ì¬ì‹œë„ ë²„íŠ¼ ì¶”ê°€
        const retryButton = document.createElement('button');
        retryButton.style.cssText = 'background: #2196f3; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin-top: 10px; font-size: 0.9em;';
        retryButton.textContent = 'ğŸ”„ ë‹¤ì‹œ ì‹œë„í•˜ê¸°';
        retryButton.onclick = () => {
            // ì˜¤ë‹µ ë©”ì‹œì§€ ì œê±°
            incorrectDiv.remove();
            
            // ëª¨ë“  ì„ íƒì§€ ì´ˆê¸°í™”
            options.forEach(o => {
                o.classList.remove('correct', 'wrong');
                o.style.pointerEvents = 'auto';
            });
            
            quizAnswered = false;
        };
        incorrectDiv.appendChild(retryButton);
        
        return; // ì˜¤ë‹µì¼ ê²½ìš° ì—¬ê¸°ì„œ í•¨ìˆ˜ ì¢…ë£Œ
    }
    
    quizAnswered=true;
}

/* =========================
   ì´ˆê¸° ë¡œë“œ
   ========================= */
document.addEventListener('DOMContentLoaded', ()=>{
    // 1ë‹¨ê³„ í™œì„±í™” ë³´ì¥
    activateStep(1);
});
</script>
</body>
</html>
